
#thiis wlll be a user-data script eventually

apt install -y cloud-image-utils qemu-kvm libvirt-daemon-system libvirt-clients bridge-utils



apt install -y wireguard
touch /etc/wireguard/private.key
chmod go= /etc/wireguard/private.key
wg genkey > /etc/wireguard/private.key
cat /etc/wireguard/private.key | wg pubkey | sudo tee /etc/wireguard/public.key


cat <<EOF > /etc/wireguard/wg0.conf
[Interface]
PrivateKey = $(cat /etc/wireguard/private.key)
Address = 100.64.0.1/24
ListenPort = 8465
SaveConfig = false

EOF

chmod go= /etc/wireguard/wg0.conf

cat <<EOF >> /etc/sysctl.conf

net.ipv4.ip_forward=1

EOF

sysctl -p

systemctl enable wg-quick@wg0.service
systemctl start wg-quick@wg0.service
